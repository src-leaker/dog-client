package fr.dog.module.impl.exploit;

import fr.dog.event.annotations.SubscribeEvent;
import fr.dog.event.impl.player.PlayerTickEvent;
import fr.dog.module.Module;
import fr.dog.module.ModuleCategory;
import fr.dog.property.impl.BooleanProperty;
import fr.dog.property.impl.ModeProperty;
import fr.dog.util.packet.PacketUtil;
import fr.dog.util.player.ChatUtil;
import net.minecraft.client.Minecraft;
import net.minecraft.command.ICommandSender;
import net.minecraft.item.ItemSword;
import net.minecraft.network.play.client.C08PacketPlayerBlockPlacement;
import net.minecraft.network.play.client.C09PacketHeldItemChange;

public class Respawn extends Module {
    public ModeProperty respawn = ModeProperty.newInstance("Respawn Mode", new String[]{"PolarGround", "RinaorcHub"}, "RinaorcHub");
    public BooleanProperty auto = BooleanProperty.newInstance("Auto Respawn", false);

    public boolean hasSendCommand = false;

    public Respawn() {
        super("Respawn", ModuleCategory.EXPLOIT);
        this.registerProperties(respawn, auto);
    }

    @Override
    public void onEnable() {
        super.onEnable();
        hasSendCommand = false;
    }

    @SubscribeEvent
    private void onUpdate(PlayerTickEvent event) {
        this.setSuffix(respawn.getValue());
        if (mc.thePlayer != null) {
            switch (respawn.getValue()) {
                case "PolarGround":
                    if (canAuto()) {
                        mc.thePlayer.motionY = 0.45;
                        mc.thePlayer.motionX = 0.45;
                        mc.thePlayer.jump();
                        mc.thePlayer.onGround = true;
                        mc.thePlayer.jump();
                    }

                    hasSendCommand = false;
                    break;
                case "RinaorcHub":
                    if (!hasSendCommand) {
                        if (canAuto()) {
                            sendChatMessage();
                            hasSendCommand = true;
                        }
                    } else if (mc.thePlayer.inventory.getStackInSlot(6) != null
                            && mc.thePlayer.inventory.getStackInSlot(6).getItem() instanceof ItemSword
                            && mc.thePlayer.ticksExisted > 40
                            && mc.thePlayer.ticksExisted < 200) {

                        PacketUtil.sendPacket(new C09PacketHeldItemChange(6));
                        PacketUtil.sendPacket(new C08PacketPlayerBlockPlacement(mc.thePlayer.inventory.getStackInSlot(6)));

                        hasSendCommand = false;
                        ChatUtil.display("BadAiim Own Rinaorc :3");
                    }
                    break;
            }
        }
    }

    private void sendChatMessage() {
        ICommandSender commandSender = Minecraft.getMinecraft().thePlayer;
        Minecraft.getMinecraft().ingameGUI.getChatGUI().addToSentMessages("/hub");
        Minecraft.getMinecraft().thePlayer.sendChatMessage("/hub");
    }

    public boolean canAuto() {
        if (auto.getValue()) {
            return mc.thePlayer.getHealth() < 4;
        }
        return true;
    }
}
